pragma solidity 0.8.14;

import "forge-std/Test.sol";
import "../contracts/amb/TrustlessAMB.sol";
import "../contracts/light_client/mocks/LightClientChainMock.sol";
import "../contracts/light_client/mocks/BeaconLightClientMock.sol";

contract TrustlessAMBTest is Test {
    BeaconLightClientMock homeLC;
    TrustlessAMB foreign;

    function setUp() public {
        homeLC = new BeaconLightClientMock();
        foreign = new TrustlessAMB();
        foreign.initialize(address(homeLC), 2000000, address(0xb44ea27353D96890CB6adD8D5F7De6837bD3322a));
    }

    function testStorageProof() public {
        homeLC.setHead(
            1344,
            0x761f35ed043ea6aaf33a1f29a1774efc4616db156c06122771a971f9a94e0100,
            0x70c1260c93035fd133f6d3507603d449f54d41ac24473d471b7340c488485b9f
        );

        bytes memory message = hex"000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077b45697f481308c8e4f3e18d49e27a6db3d1aa000000000000000000000000077b45697f481308c8e4f3e18d49e27a6db3d1aa000000000000000000000000000000000000000000000000000000000000f424000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001442ae87cdd0000000000000000000000002030fe144bfb3b4b4a06a1aedceddde43b48cd6b00000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000001200000000000000000000000055578a741a4c74ee8a5b7197daea322fcc8937140000000000000000000000000000000000000000000000000de0b6b3a7640000000000000000000000000000000000000000000000000000000000000000000d57726170706564204574686572000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004574554480000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
        bytes32[] memory proof1 = new bytes32[](9);
        bytes[] memory proof2 = new bytes[](3);
        bytes[] memory proof3 = new bytes[](3);
        proof1[0] = 0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421;
        proof1[1] = 0xb3051753b994e1c4cc49c08b0800059934c7bd66ee74c1554f867522577a3f4c;
        proof1[2] = 0x7dad205a43056168a2ab43cdbfd49d91fe2a8fb7731df81dee979f0156034279;
        proof1[3] = 0xde3a779059847a8695126f94083c1c5e3f41f9cddb7da2671df125362d9365fc;
        proof1[4] = 0x0000000000000000000000000000000000000000000000000000000000000000;
        proof1[5] = 0xf5a5fd42d16a20302798ef6ed309979b43003d2320d9f0e8ea9831a92759fb4b;
        proof1[6] = 0xdb56114e00fdd4c1f85c892bf35ac9a89289aaecb1ebd0a96cde606a748b5d71;
        proof1[7] = 0xedbd76363a22100be5b57adbc609ea8a06bcc25fbb18cf1771bb9b40ba1ca23e;
        proof1[8] = 0x229b7eace252564fd280eb03aa817c945d8996af411d0583e18f3bd4065d178b;

        proof2[0] = hex"f9019180a0fbccc2583d966b29b896c188df51c81c2c36f36b6d331b7bf02a7ed6297b8087a04cdacc78cda925da0025db01c286625be2b01cf552ad222fc349305724a6ad2280a01a697e814758281972fcd13bc9707dbcd2f195986b05463d7b78426508445a04a0c27b449b11a28c5f22484ab68aca9c1c0ff7a3263da7c4b76482ff9b29beb05da0c2c799b60a0cd6acd42c1015512872e86c186bcf196e85061e76842f3b7cf86080a02e0d86c3befd177f574a20ac63804532889077e955320c9361cd10b7cc6f5809a096ea482821c7b4fdd6980bbe56a5c4b4422aa603f3b9ff8c6f71cee1383a3ac6a06301b39b2ea8a44df8b0356120db64b788e71f52e1d7a6309d0d2e5b86fee7cb80a0d52c8608062d289beffe1ce422d27a59bbd41dd4033ed310f91695d8787a4020a01b7779e149cadf24d4ffb77ca7e11314b8db7097e4d70b2a173493153ca2e5a0a0e9835af16537f985d9294799a7930b1b6f3051ef94485b7271d01fd279d70746a0d65c616dd8a84507c1bee3e3e112e3bc9451c2fb42670d7b47f499545b194e0780";
        proof2[1] = hex"f85180808080a00eab600fe336f5b670607bdc82fd1878b573e3f08551169b1116b81ef9cd0d9480a0f12eeda8675708cc6c89a7ff9d7231016242393c28b2f99d9856ee400056743e80808080808080808080";
        proof2[2] = hex"f869a020debdd37df58f72ba0cb2bf3b3cb803dcb0ab59578ff64672ee960d44b765f4b846f8440180a09f42f5f77be1095b8d6d71325da4b84215558dd4094b33b1b43aed402238cfdba083a9d161e1390570f3f5c88f938ea9e1a17f13f26d636e9b9441cfe51d15173f";

        proof3[0] = hex"f90131a01823e96f74a3c82318631318cd929217a62f4093f245594ac91c52bd9163de35a0354b102a1117d45406a3340aeea6633cbe0a9033a8ad27c5d7f2e4cf015b9d8780a0074c2d2b1e6999bec61e07ba723c1b540c97051e2c4ae02978aa565899cf265080a0c9cd6532fc826b640d79cf1ae443c6969b93af3c97730988b7eb329d9789fe7580a045ba96f416399dea66992fae365e3ce155e72c87c1f6a3776ba70835b73d67bba0111a574ac2ac20470c17d56275a338b60ebe644b9e167fd09c01a206d31cb21e80a0e62539247d6d4fddcc79023513a5541e70ca74bca696fcfaa32e7471c8609cc480a01818b2cf37f67b268a9805de29ee6f2eb8664874fb4c34ffeb3ef5eccf38a9b58080a0385c5e0dded976fd370e9ad8d039128b2ad89b8026ac31e93fc36fa09155639580";
        proof3[1] = hex"f851a0e22b7eb8355e562e3e5fc58bdc924a2fd88da78f6754bf26eba093960a8b41d28080808080a04edea7266c9bef2150ae7ddcddc6889a11bf60669323b83573860ddaf3c9006380808080808080808080";
        proof3[2] = hex"f843a020df3dcda05b4fbd9c655cde3d5ceb211e019e72ec816e127a59e7195f2cd7f5a1a0e9ef092d372b7f0f366c9c42f1ed9a59ea5583dee9f668979017cb4ba9933b8b";
        foreign.executeMessage(1344, message, proof1, proof2, proof3);
    }

    function testLogProof() public {
        homeLC.setHead(
            1344,
            0x761f35ed043ea6aaf33a1f29a1774efc4616db156c06122771a971f9a94e0100,
            0x909f0d832bd99a1dee36e67d4929485ce0fa249c39734ce5b72cee3717992a49
        );

        bytes memory message = hex"000000000000000000000000000000000000000000000000000000000000000f00000000000000000000000077b45697f481308c8e4f3e18d49e27a6db3d1aa000000000000000000000000077b45697f481308c8e4f3e18d49e27a6db3d1aa000000000000000000000000000000000000000000000000000000000001e848000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001442ae87cdd0000000000000000000000002030fe144bfb3b4b4a06a1aedceddde43b48cd6b00000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000001200000000000000000000000055578a741a4c74ee8a5b7197daea322fcc8937140000000000000000000000000000000000000000000000000de0b6b3a7640000000000000000000000000000000000000000000000000000000000000000000d57726170706564204574686572000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004574554480000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
        bytes32[] memory proof1 = new bytes32[](27);
        proof1[0] = 0x9dbbf6ece03295e2774214b456f96129b2b1b6093a40c9f24327233b19ded8bf;
        proof1[1] = 0xdcdc056f2e556068a6b218ef9a9347b6ecb7ae39e7e7367ce2eafeded24f5103;
        proof1[2] = 0x1342a6fc4f8370b001e1aea644b040366468d6e387ea4c9c2451602e827e11ef;
        proof1[3] = 0x0a00a5f142b99a07c34b524c463ae7663cefd9881ddfce5ab073ca6956ad15a6;
        proof1[4] = 0x0000000000000000000000000000000000000000000000000000000000000000;
        proof1[5] = 0xf5a5fd42d16a20302798ef6ed309979b43003d2320d9f0e8ea9831a92759fb4b;
        proof1[6] = 0xdb56114e00fdd4c1f85c892bf35ac9a89289aaecb1ebd0a96cde606a748b5d71;
        proof1[7] = 0xf3e747af26d60475a79a79775d3a0c7808784f4d36cdb07ca91b722da60baf17;
        proof1[8] = 0x386722c23923d6a1569d2c26f377f7b0f194b89f6d5470fb98b05fa156d9d2b4;
        proof1[9] = 0xc27933af9b88f359227c7e62a8aabccf1691761272920a7d94175b4234a67c90;
        proof1[10] = 0xd6c5088564d6c6c7383070706d1fbdd49334951f999570d08890143f2c1eebd5;
        proof1[11] = 0x4701e4ffed1349b068311471c3fa1ae92d3c1dec7f9e286c1e6bf57aa3ca21fe;
        proof1[12] = 0xfb2a2c42a55323b08996f3054d5e9a28ec9f41249c737aad04095aa7410c1a99;
        proof1[13] = 0x98a5e47bb4c8a64b8ce991953b795c0bc68fe60a44265a3999005410b1eeb204;
        proof1[14] = 0xd5bfca2d80d712b91717b82e2a961f39d14fa7dcd24eb21c7517c63c1f485f1c;
        proof1[15] = 0xd88ddfeed400a8755596b21942c1497e114c302e6118290f91e6772976041fa1;
        proof1[16] = 0x87eb0ddba57e35f6d286673802a4af5975e22506c7cf4c64bb6be5ee11527f2c;
        proof1[17] = 0xb8a4fc3477645b60c13fe9fb59d92ecf991c92f58c2cde88818572c0e22d65f7;
        proof1[18] = 0x506d86582d252405b840018792cad2bf1259f1ef5aa5f887e13cb2f0094f51e1;
        proof1[19] = 0xdbe106a7ce38ae49e7722ac005d43b61786fed680e42765bc3ca79a13b814cf5;
        proof1[20] = 0x6cf04127db05441cd833107a52be852868890e4317e6a02ab47683aa75964220;
        proof1[21] = 0xb7d05f875f140027ef5118a2247bbb84ce8f2f0f1123623085daf7960c329f5f;
        proof1[22] = 0xa75b0948052d091c3cb41f390e76fc7cb987b787bf4063c563e09266a357dea1;
        proof1[23] = 0x84e238b88a84784c84c9cfb2677d292726c81e382a11cd3c331f8a27febea9a2;
        proof1[24] = 0x9ade20f7a2b91368915e3ab510e89845653ed1a7b74813ddd20fbe3294f245d5;
        proof1[25] = 0xbc560f31e9336046adf6e73f1b2838e45b08b95cd5dfa9a67168691febeba8d5;
        proof1[26] = 0x6eb4ef9393211212038aef54891fd1b2e9c90a4498f514999a29f2009b7e30d6;
        bytes[] memory proof2 = new bytes[](1);
        proof2[0] = hex"f905cc822080b905c602f905c20183036c02b9010000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000002020000008000000000088000000000000010000000000000000008002020000000000400000000080000400000000000000000001000000100010000000000000000000040800000000000200000000000001000000001000080000000000000000000000080000000000000000000000000000000000000000000000010000000402000000001000000000000900000800000000000000000000000002000000000200000000000000000000000000000000200000400000000000002000f904b7f87a942030fe144bfb3b4b4a06a1aedceddde43b48cd6bf842a0e1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109ca0000000000000000000000000b6860ba59b8bd17dd6a33647c320901f083ccd93a00000000000000000000000000000000000000000000000000de0b6b3a7640000f89b942030fe144bfb3b4b4a06a1aedceddde43b48cd6bf863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa0000000000000000000000000b6860ba59b8bd17dd6a33647c320901f083ccd93a000000000000000000000000077b45697f481308c8e4f3e18d49e27a6db3d1aa0a00000000000000000000000000000000000000000000000000de0b6b3a7640000f902dd94b44ea27353d96890cb6add8d5f7de6837bd3322af863a0d272c9b6e024bd86cfdcf4dac1c1db8e1c4bcdebd4a65967d5d0218ab0d55a1ea064dcd43071809d175a28959d37f4cb0168e2509e78f657e3e6cbe0d0192151cfa0000000000000000000000000000000000000000000000000000000000000000fb9026000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000f00000000000000000000000077b45697f481308c8e4f3e18d49e27a6db3d1aa000000000000000000000000077b45697f481308c8e4f3e18d49e27a6db3d1aa000000000000000000000000000000000000000000000000000000000001e848000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001442ae87cdd0000000000000000000000002030fe144bfb3b4b4a06a1aedceddde43b48cd6b00000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000001200000000000000000000000055578a741a4c74ee8a5b7197daea322fcc8937140000000000000000000000000000000000000000000000000de0b6b3a7640000000000000000000000000000000000000000000000000000000000000000000d57726170706564204574686572000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004574554480000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f8bc9477b45697f481308c8e4f3e18d49e27a6db3d1aa0f884a059a9a8027b9c87b961e254899821c9a276b5efc35d1f7409ea4f291470f1629aa00000000000000000000000002030fe144bfb3b4b4a06a1aedceddde43b48cd6ba0000000000000000000000000b6860ba59b8bd17dd6a33647c320901f083ccd93a064dcd43071809d175a28959d37f4cb0168e2509e78f657e3e6cbe0d0192151cfa00000000000000000000000000000000000000000000000000de0b6b3a7640000";
        foreign.executeMessageFromLog(1344, 1320, 0, 2, message, proof1, proof2);
    }
}
